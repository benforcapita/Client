{"ast":null,"code":"\"use strict\";\n/* eslint-disable no-process-exit */\n\nconst util = require(\"util\");\n\nconst _require = require(\"../../..\"),\n      JSDOM = _require.JSDOM;\n\nconst tough = require(\"tough-cookie\");\n\nconst xhrSymbols = require(\"./xmlhttprequest-symbols.js\");\n\nconst dom = new JSDOM();\nconst xhr = new dom.window.XMLHttpRequest();\nconst chunks = [];\nprocess.stdin.on(\"data\", chunk => {\n  chunks.push(chunk);\n});\nprocess.stdin.on(\"end\", () => {\n  const buffer = Buffer.concat(chunks);\n  const flag = JSON.parse(buffer.toString());\n\n  if (flag.body && flag.body.type === \"Buffer\" && flag.body.data) {\n    flag.body = Buffer.from(flag.body.data);\n  }\n\n  if (flag.cookieJar) {\n    flag.cookieJar = tough.CookieJar.fromJSON(flag.cookieJar);\n  }\n\n  flag.synchronous = false;\n  xhr[xhrSymbols.flag] = flag;\n  const properties = xhr[xhrSymbols.properties];\n  properties.readyState = xhr.OPENED;\n\n  try {\n    xhr.addEventListener(\"loadend\", () => {\n      if (properties.error) {\n        properties.error = properties.error.stack || util.inspect(properties.error);\n      }\n\n      process.stdout.write(JSON.stringify({\n        properties\n      }), () => {\n        process.exit(0);\n      });\n    }, false);\n    xhr.send(flag.body);\n  } catch (error) {\n    properties.error += error.stack || util.inspect(error);\n    process.stdout.write(JSON.stringify({\n      properties\n    }), () => {\n      process.exit(0);\n    });\n  }\n});","map":null,"metadata":{},"sourceType":"script"}